
oarsub -I -l slash_22=1+{"virtual!='NO' AND cluster='gemini'"}/nodes=1,walltime=2

echo "Host;start;idle;`date -u -R`" >> idle_host.log && sleep 600 &&     echo "Host;end;idle;`date -u -R`" >> idle_host.log;
echo "Docker;start;idle;`date -u -R`" >> idle_docker2701.log && sleep 600 &&     echo "Docker;end;idle;`date -u -R`" >> idle_docker2701.log;

sudo-g5k /grid5000/code/bin/g5k-setup-docker  
#Baixar e configurar o git no docker DEBIAN 10 

docker run -it debian:stable /bin/bash  

#docker run -it -m 512M ubuntu /bin/bash
#docker run -it --cpu-shares 1024 ubuntu /bin/bash
#docker run -it --cpu-shares 4096 debian:stable /bin/bash  

apt-get update -y 
apt-get install curl -y 
curl -s https://packagecloud.io/install/repositories/akopytov/sysbench/script.deb.sh | bash 
apt-get install git wget vim sysbench -y  
 
git config --global user.email "alinesmoreiraicloud@gmail.com" 
git config --global user.name "Aline Moreira" 
git clone https://github.com/aline-moreira/grid_tests.git

!!MOVA O DIRETORIO PARA A PASTA DO TEST SYSBENCH!!!

for cpu in {1,2,3,4}; do
echo "Docker;start;$cpu;`date -u -R`" >> sysbench_docker.log;
sysbench cpu --cpu-max-prime=2000000000 --forced-shutdown=0 --threads=$cpu --max-time=600 run > docker_cpu"$cpu"_data.log;
echo "Docker;end;$cpu;`date -u -R`" >> sysbench_docker.log;
sleep 60;
done;
!!MOVA O DIRETORIO PARA A PASTA DO TEST SYSBENCH!!



echo "Docker;start;`date -u -R`" >> sysbench_docker.log && sysbench memory --memory-block-size=1G --memory-total-size=10000G --time=300 run > docker_mem_data.log && echo "Docker;end;`date -u -R`" >> sysbench_docker.log && sleep 30

!MOVA O DIRETORIO PARA A PASTA DO TEST SYSBENCH IO !!

TOTAL_SIZE=30G
mkdir io_test && cd io_test && sysbench fileio --file-total-size=$TOTAL_SIZE prepare && echo "Docker;start;`date -u -R`" >> ../sysbench_docker.log && sysbench fileio --file-total-size=$TOTAL_SIZE --file-test-mode=rndrw --time=300 --max-requests=0 run  > ../docker_io_data.log && echo "Docker;end;`date -u -R`" >> ../sysbench_docker.log && sleep 30 && sysbench fileio --file-total-size=$TOTAL_SIZE cleanup && cd .. && rm -r io_test

#Agora adiciona no git
git add *
git commit -m "update"
git push aline-moreira a@991817274
#Exit container
exit
sudo-g5k stop docker

#NESSE PONTO, VOCE ESTÃ NO HOST, GERE O ARQUIVO DE ENERGIA E SUBA NO GIT.

curl -kn https://api.grid5000.fr/stable/sites/lyon/metrics/power/timeseries/?job_id=$OAR_JOB_ID > energy_$OAR_JOB_ID.json
/home/mpillon/grid_tests/energy_"$OAR_JOB_ID".json

